<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <title>Sentinel · Network Report</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <link rel="stylesheet" href="./vendor/reset.min.css" />
    <link rel="stylesheet" href="./css/styles.css" />

    <!-- Network 페이지 전용 스타일 -->
    <style>
      /* 메인 레이아웃: 상단 네비 아래 여백 + 중앙 정렬 */
      .network-layout {
        max-width: 1440px;
        margin: 32px auto 40px;
        padding: 0 24px;
      }

      /* 행(가로 2카드) 레이아웃 */
      .network-row {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
      }

      /* 카드 공통: report-card 스타일을 그대로 사용하되, flex로 너비 조절 */
      .network-card {
        flex: 1 1 0;
      }

      /* 첫 번째 행 카드 비율 (왼쪽: 오른쪽보다 약간 좁게) */
      .network-row--top .network-card--left {
        flex: 0.95;
      }
      .network-row--top .network-card--right {
        flex: 1.05;
      }

      /* 카드 안쪽 약간만 조정 */
      .network-top-body {
        display: flex;
        align-items: center;
        gap: 32px;
      }

      .network-chart-area {
        flex: 1 1 auto;
      }

      /* 숫자 pill */
      .pill-large {
        min-width: 140px;
        padding: 12px 16px;
        border-radius: 14px;
        background: #f5f7fd;
        border: 1px solid #dde3f5;
        text-align: left;
      }

      .pill-large-main {
        font-size: 28px;
        font-weight: 700;
        color: #1b2340;
        line-height: 1.1;
      }

      .pill-large-label {
        font-size: 12px;
        margin-top: 4px;
        color: #7a8094;
      }

      /* 네트워크용 카드 상단/설명 */
      .card-subtitle {
        font-size: 11px;
      }

      /* -------- 상위 3개 대역 카드 스타일 -------- */
      .network-bands-cards {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 12px;
      }

      .network-band-card {
        border-radius: 14px;
        background: #f5f7fd;
        border: 1px solid #dde3f5;
        padding: 10px 14px;
        box-shadow: 0 1px 3px rgba(20, 40, 80, 0.05);
      }

      .network-band-card-title {
        font-weight: 700;
        font-size: 13px;
        color: #1b2340;
        margin-bottom: 6px;
      }

      .network-band-card-body {
        font-size: 12px;
        line-height: 1.5;
        color: #2f3345;
        white-space: pre-line;
      }

      /* 데이터 없을 때 한 줄만 가운데 띄우기 */
      .network-bands-cards .empty-hint {
        grid-column: 1 / -1;
      }

      /* 의심 PC 리스트 스타일 */
      .bullet-list {
        margin: 0 0 8px;
        padding-left: 18px;
        font-size: 13px;
        color: #2f3345;
      }

      .bullet-list li + li {
        margin-top: 4px;
      }

      .empty-hint {
        margin-top: 6px;
        font-size: 11px;
        color: #8b90a5;
      }

      /* -------- 테이블 스타일 강화 -------- */
      .table-wrapper {
        width: 100%;
        overflow-x: auto;
      }

      .network-table {
        width: 100%;
        border-collapse: collapse;
      }

      .network-table thead {
        background: #f5f7fd;
      }

      .network-table th,
      .network-table td {
        white-space: nowrap;
        padding: 8px 10px;
        font-size: 12px;
      }

      .network-table th {
        font-weight: 700;
        color: #1b2340;
        border-bottom: 1px solid #dde3f5;
      }

      .network-table td {
        border-bottom: 1px solid #f0f2fa;
        color: #303547;
      }

      .network-table tbody tr:nth-child(even) td {
        background: #fafbff;
      }

      .network-table tbody tr:hover td {
        background: #eef3ff;
      }

      /* 반응형: 폭이 좁을 때는 세로로 쌓기 */
      @media (max-width: 1100px) {
        .network-row {
          flex-direction: column;
        }
        .network-row--top .network-card--left,
        .network-row--top .network-card--right {
          flex: 1 1 auto;
        }
        .network-top-body {
          flex-direction: column;
          align-items: flex-start;
        }
        .network-bands-cards {
          grid-template-columns: repeat(1, minmax(0, 1fr));
        }
      }

      /* ✅ flex 카드가 내용 때문에 가로로 안 밀리게 (핵심) */
.network-card {
  min-width: 0; /* flex item shrink 허용 */
}

/* ✅ 2행 카드 높이 늘어나는 것 방지: 내부 스크롤로 처리 */
#suspicious-pc-list {
  max-height: 320px;     /* 필요하면 280~420 조절 */
  overflow-y: auto;
  padding-right: 6px;    /* 스크롤바 여백 */
}

/* 긴 (PUBLIC/PRIVATE/PC) 문자열이 카드 밖으로 튀는 것 방지 */
#suspicious-pc-list li {
  overflow-wrap: anywhere;
  word-break: break-word;
}

/* ✅ 테이블도 카드 안에서만 스크롤되게 */
.network-row .table-wrapper {
  max-height: 360px;  /* 필요하면 조절 */
  overflow: auto;     /* x/y 둘 다 스크롤 */
}

/* (선택) 헤더 고정하면 더 안정적 */
.network-table thead th {
  position: sticky;
  top: 0;
  background: #f5f7fd;
  z-index: 1;
}

    </style>
  </head>

  <body class="sentinel-body">
    <!-- 상단 네비게이션 바 -->
    <header class="top-nav">
      <div class="top-nav-left">
        <div class="top-logo">
          <span class="top-logo-main">SENTINEL</span>
          <span class="top-logo-sub">DASHBOARD</span>
        </div>

        <nav class="top-menu">
          <a class="top-menu-item" href="./dashboard.html">DASHBOARD</a>
          <a class="top-menu-item" href="./report.html">REPORT</a>
          <a class="top-menu-item" href="./logs.html">LOGS</a>
          <a class="top-menu-item" href="./reason.html">Analysis</a>
          <a
            class="top-menu-item top-menu-item--active"
            href="./network.html"
            >NETWORK</a
          >
          <a class="top-menu-item" href="./score.html">Score</a>
          <a class="top-menu-item" href="./settings.html">SETTINGS</a>
        </nav>
      </div>

      <div class="top-nav-right">
        <span class="top-updated-label">UPDATED:</span>
        <span id="top-updated-at" class="top-updated-value">--:--:-- KST</span>

        <button id="btn-refresh" class="btn btn-small">Refresh</button>
      </div>
    </header>

    <!-- 메인 컨텐츠 -->
    <main class="network-layout">
      <!-- 1행: PUBLIC 대역 개수 + 대역폭 별 연결 사설망 -->
      <section class="network-row network-row--top">
        <!-- PUBLIC 대역 개수 + 파이차트 -->
        <article class="card report-card network-card network-card--left">
          <header class="card-header">
            <h3 class="card-title">공인 IP 개수</h3>
            <!-- <span class="card-subtitle">
              공인 IP가 탐지된 /16 대역 수 및 사용 현황
            </span> -->
          </header>
          <div class="card-body network-top-body">
            <div class="pill-large">
              <div id="public-band-count" class="pill-large-main">--</div>
              <div class="pill-large-label">공인 IP 개수</div>
            </div>

            <div class="network-chart-area">
              <h4 class="card-subtitle">대역폭 사용 현황</h4>
              <canvas id="chart-public-bands" height="200"></canvas>
              <p
                id="public-bands-empty"
                class="empty-hint"
                style="display: none"
              >
                공인 IP 대역 사용 로그가 없습니다.
              </p>
            </div>
          </div>
        </article>

        <!-- 대역폭 별 연결 사설망 (상위 3개) -->
        <article class="card report-card network-card network-card--right">
          <header class="card-header">
            <h3 class="card-title">
              대역폭 별 연결 사설망 (대역폭 사용 개수 상위 3개)
            </h3>
            <!-- <span class="card-subtitle">
              공인 IP /16 대역 기준으로 연결된 사설망과 중요정보 탐지 로그
            </span> -->
          </header>
          <div class="card-body">
            <div id="top-private-bands" class="network-bands-cards">
              <p class="empty-hint">
                데이터를 불러오는 중입니다...
              </p>
            </div>
          </div>
        </article>
      </section>

      <!-- 2행: 외부 IP 사용 의심 PC 정보 + 로그 테이블 -->
      <section class="network-row">
        <!-- 외부 IP 사용 의심 PC 정보 -->
        <article class="card report-card network-card">
          <header class="card-header">
            <h3 class="card-title">비정상 네트워크 사용 의심 PC</h3>
            <span class="card-subtitle">
              PUBLIC IP / PRIVATE IP / PC NAME 조합으로 직접 노출 및 신규
              출구 탐지
            </span>
          </header>
          <div class="card-body">
            <ul id="suspicious-pc-list" class="bullet-list">
              <li>데이터를 불러오는 중입니다...</li>
            </ul>
            <p class="empty-hint">
              • <strong>(PUBLIC IP) / (PRIVATE IP) / (PC NAME)</strong> 형식으로
              표시됩니다.<br />
              • 직접 노출: PUBLIC IP와 PRIVATE IP가 동일한 경우<br />
              • 신규 출구: PRIVATE IP가 사설망이 아닌 경우
            </p>
          </div>
        </article>

        <!-- 외부 IP 사용 의심 PC 로그 테이블 -->
        <article class="card report-card network-card">
          <header class="card-header">
            <h3 class="card-title">비정상 네트워크 사용 의심 행위 로그</h3>
            <!-- <span class="card-subtitle">
              의심 PC에서 발생한 LLM/MCP 요청 이력 (최신 50건)
            </span> -->
          </header>
          <div class="card-body">
            <div class="table-wrapper">
              <table class="table network-table">
                <thead>
                  <tr>
                    <th>프롬프트 입력 내용</th>
                    <th>탐지 시간</th>
                    <th>서비스명</th>
                    <th>PC 이름</th>
                    <th>공인 IP</th>
                    <th>사설 IP</th>
                    <th>인터페이스</th>
                    <th>처리 결과</th>
                    <th>민감 여부</th>
                    <th>파일 차단 여부</th>
                    <th>탐지 정보 내역</th>
                  </tr>
                </thead>
                <tbody id="network-table-body">
                  <tr>
                    <td colspan="11">외부 IP 사용 의심 PC 로그가 없습니다.</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </article>
      </section>
    </main>

    <!-- 스크립트 -->
    <script src="./vendor/chart.umd.min.js"></script>
    <script src="./js/api.js"></script>
    <script src="./js/network.js"></script>
  </body>
</html>
